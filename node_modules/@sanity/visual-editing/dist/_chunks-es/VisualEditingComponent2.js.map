{"version":3,"file":"VisualEditingComponent2.js","sources":["../../src/react-router/VisualEditingComponent.tsx"],"sourcesContent":["import {startTransition, useEffect, useRef, useState} from 'react'\nimport {useLocation, useNavigate, useRevalidator} from 'react-router'\n\nimport {type HistoryAdapterNavigate, type HistoryRefresh, type VisualEditingOptions} from '../types'\nimport {enableVisualEditing} from '../ui/enableVisualEditing'\n\n/**\n * @public\n */\nexport interface VisualEditingProps extends Omit<VisualEditingOptions, 'history' | 'refresh'> {\n  /**\n   * @deprecated The history adapter is already implemented\n   */\n  history?: never\n  /**\n   * The refresh API allows smarter refresh logic than the default `location.reload()` behavior.\n   * You can call the refreshDefault argument to trigger the default refresh behavior so you don't have to reimplement it.\n   */\n  refresh?: (\n    payload: HistoryRefresh,\n    refreshDefault: () => false | Promise<void>,\n  ) => false | Promise<void>\n}\n\nexport default function VisualEditingComponent(props: VisualEditingProps): null {\n  const {components, refresh, zIndex, onPerspectiveChange} = props\n\n  const navigateRemix = useNavigate()\n  const navigateRemixRef = useRef(navigateRemix)\n  const [navigate, setNavigate] = useState<HistoryAdapterNavigate | undefined>()\n  const revalidator = useRevalidator()\n  const [revalidatorPromise, setRevalidatorPromise] = useState<(() => void) | null>(null)\n  const [revalidatorLoading, setRevalidatorLoading] = useState(false)\n\n  useEffect(() => {\n    navigateRemixRef.current = navigateRemix\n  }, [navigateRemix])\n  useEffect(() => {\n    if (revalidatorPromise && revalidator.state === 'loading') {\n      startTransition(() => setRevalidatorLoading(true))\n    } else if (revalidatorPromise && revalidatorLoading && revalidator.state === 'idle') {\n      revalidatorPromise()\n      startTransition(() => {\n        setRevalidatorPromise(null)\n        setRevalidatorLoading(false)\n      })\n    }\n  }, [revalidatorLoading, revalidator.state, revalidatorPromise])\n  useEffect(() => {\n    const disable = enableVisualEditing({\n      components,\n      zIndex,\n      onPerspectiveChange,\n      refresh: (payload) => {\n        function refreshDefault() {\n          if (payload.source === 'mutation' && payload.livePreviewEnabled) {\n            return false\n          }\n          return new Promise<void>((resolve) => {\n            revalidator.revalidate()\n            setRevalidatorPromise(() => resolve)\n          })\n        }\n        return refresh ? refresh(payload, refreshDefault) : refreshDefault()\n      },\n      history: {\n        subscribe: (_navigate) => {\n          setNavigate(() => _navigate)\n          return () => setNavigate(undefined)\n        },\n        update: (update) => {\n          if (update.type === 'push' || update.type === 'replace') {\n            navigateRemixRef.current(update.url, {\n              replace: update.type === 'replace',\n            })\n          } else if (update.type === 'pop') {\n            navigateRemixRef.current(-1)\n          }\n        },\n      },\n    })\n    return () => disable()\n  }, [components, refresh, revalidator, zIndex, onPerspectiveChange])\n\n  const location = useLocation()\n  useEffect(() => {\n    if (navigate) {\n      navigate({\n        type: 'push',\n        url: `${location.pathname}${location.search}${location.hash}`,\n      })\n    }\n  }, [location.hash, location.pathname, location.search, navigate])\n\n  return null\n}\n"],"names":["VisualEditingComponent","props","$","_c","components","refresh","zIndex","onPerspectiveChange","navigateRemix","useNavigate","navigateRemixRef","useRef","navigate","setNavigate","useState","revalidator","useRevalidator","revalidatorPromise","setRevalidatorPromise","revalidatorLoading","setRevalidatorLoading","t0","t1","current","useEffect","t2","t3","state","startTransition","t4","t5","disable","enableVisualEditing","payload","refreshDefault","source","livePreviewEnabled","Promise","resolve","revalidate","history","subscribe","_navigate","undefined","update","type","url","replace","location","useLocation","t6","t7","hash","pathname","search"],"mappings":"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"}